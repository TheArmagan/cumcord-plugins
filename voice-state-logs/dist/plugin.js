(function(U,z,He,B){"use strict";function R(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function G(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var c=G(U),p=R(z);const Z=p.default.findByProps("getGuild","getGuildCount"),Y=p.default.findByProps("getChannel","hasChannel"),k=p.default.findByProps("getVoiceState","getUserVoiceChannelId"),q=p.default.findByProps("transitionTo"),i=p.default.findByProps("createElement"),L=p.default.findByProps("getUser","getCurrentUser"),J=p.default.findByDisplayName("TextInput"),{TooltipContainer:g}=p.default.findByProps("TooltipContainer");var v=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},_={},C={};Object.defineProperty(C,"__esModule",{value:!0}),C.default=Object.freeze({GET:"GET",SET:"SET",DELETE:"DELETE",UPDATE:"UPDATE"});var S={},T={},W=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(T,"__esModule",{value:!0});const D=W(C);class F{constructor(){this.listeners=Object.values(D.default).reduce((t,n)=>(t[n]=new Set,t),{}),this.on=function(t,n){if(this.listeners[t].has(n))throw Error(`This listener on ${t} already exists.`);this.listeners[t].add(n)},this.once=function(t,n){const a=(s,r)=>{this.off(s,a),n(s,r)};this.on(t,a)},this.off=function(t,n){this.listeners[t].delete(n)},this.emit=function(t,n){for(const a of this.listeners[t])a(t,n)};for(const t of Object.values(D.default))this[t.toLowerCase()]=n=>{this.emit(t,n)}}}T.default=F;var X=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(S,"__esModule",{value:!0});const K=X(T);function Q(e={},{nestArrays:t=!0}={}){const n=new K.default;function a(s,r,o){return new Proxy(s,{get(l,f){const d=[...o,f],m=l[f];return m!=null?(n.get({path:d,value:m}),!t&&Array.isArray(m)?m:typeof m=="object"?a(m,r,d):m):a(l[f]={},r,d)},set(l,f,d){return l[f]=d,n.set({path:[...o,f],value:d}),!0},deleteProperty(l,f){return delete l[f]?(n.delete({path:[...o,f]}),!0):!1},has(l,f){return typeof l[f]=="object"&&Object.keys(l[f]).length===0?!1:f in l}})}return Object.assign({store:a(e,e,[]),ghost:e},n)}S.default=Q,function(e){var t=v&&v.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(e,"__esModule",{value:!0}),e.make=e.Events=void 0;var n=C;Object.defineProperty(e,"Events",{enumerable:!0,get:function(){return t(n).default}});var a=S;Object.defineProperty(e,"make",{enumerable:!0,get:function(){return t(a).default}})}(_);const h=_.make({stateHistory:[],searchText:""},{nestArrays:!1});window.voiceStateNest=h;const y={DANGER:"#eb3d47",SECONDARY:"#8a8e93",SUCCESS:"#3ba55d"};function ee(e={}){return c.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:"vsl--icon vsl--deaf-icon",style:{color:e.color}},c.createElement("path",{d:"M6.16204 15.0065C6.10859 15.0022 6.05455 15 6 15H4V12C4 7.588 7.589 4 12 4C13.4809 4 14.8691 4.40439 16.0599 5.10859L17.5102 3.65835C15.9292 2.61064 14.0346 2 12 2C6.486 2 2 6.485 2 12V19.1685L6.16204 15.0065Z",fill:"currentColor"}),c.createElement("path",{d:"M19.725 9.91686C19.9043 10.5813 20 11.2796 20 12V15H18C16.896 15 16 15.896 16 17V20C16 21.104 16.896 22 18 22H20C21.105 22 22 21.104 22 20V12C22 10.7075 21.7536 9.47149 21.3053 8.33658L19.725 9.91686Z",fill:"currentColor"}),c.createElement("path",{d:"M3.20101 23.6243L1.7868 22.2101L21.5858 2.41113L23 3.82535L3.20101 23.6243Z",fill:"currentColor"}))}function te(e={}){return c.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:"vsl--icon vsl--mute-icon",style:{color:e.color}},c.createElement("path",{d:"M6.7 11H5C5 12.19 5.34 13.3 5.9 14.28L7.13 13.05C6.86 12.43 6.7 11.74 6.7 11Z",fill:"currentColor"}),c.createElement("path",{d:"M9.01 11.085C9.015 11.1125 9.02 11.14 9.02 11.17L15 5.18V5C15 3.34 13.66 2 12 2C10.34 2 9 3.34 9 5V11C9 11.03 9.005 11.0575 9.01 11.085Z",fill:"currentColor"}),c.createElement("path",{d:"M11.7237 16.0927L10.9632 16.8531L10.2533 17.5688C10.4978 17.633 10.747 17.6839 11 17.72V22H13V17.72C16.28 17.23 19 14.41 19 11H17.3C17.3 14 14.76 16.1 12 16.1C11.9076 16.1 11.8155 16.0975 11.7237 16.0927Z",fill:"currentColor"}),c.createElement("path",{d:"M21 4.27L19.73 3L3 19.73L4.27 21L8.46 16.82L9.69 15.58L11.35 13.92L14.99 10.28L21 4.27Z",fill:"currentColor"}))}function ne(e={}){return c.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:"vsl--icon vsl--video-icon",style:{color:e.color}},c.createElement("path",{d:"M21.526 8.149C21.231 7.966 20.862 7.951 20.553 8.105L18 9.382V7C18 5.897 17.103 5 16 5H4C2.897 5 2 5.897 2 7V17C2 18.104 2.897 19 4 19H16C17.103 19 18 18.104 18 17V14.618L20.553 15.894C20.694 15.965 20.847 16 21 16C21.183 16 21.365 15.949 21.526 15.851C21.82 15.668 22 15.347 22 15V9C22 8.653 21.82 8.332 21.526 8.149Z",fill:"currentColor"}))}function re(e={}){return c.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:"vsl--icon vsl--login-icon",style:{color:e.color}},c.createElement("path",{d:"M10 11V8l5 4-5 4v-3H1v-2h9zm-7.542 4h2.124A8.003 8.003 0 0 0 20 12 8 8 0 0 0 4.582 9H2.458C3.732 4.943 7.522 2 12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10c-4.478 0-8.268-2.943-9.542-7z",fill:"currentColor"}))}function ae(e={}){return c.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:"vsl--icon vsl--logout-icon",style:{color:e.color}},c.createElement("path",{d:"M5 11h8v2H5v3l-5-4 5-4v3zm-1 7h2.708a8 8 0 1 0 0-12H4A9.985 9.985 0 0 1 12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10a9.985 9.985 0 0 1-8-4z",fill:"currentColor"}))}function ie(e={}){return c.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:"vsl--icon vsl--dot-circle-icon",style:{color:e.color}},c.createElement("path",{d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-5a3 3 0 1 1 0-6 3 3 0 0 1 0 6z",fill:"currentColor"}))}const oe=p.default.findByProps("thin","scrollerBase");function se(){let[e,t]=i.useState([]),[n,a]=i.useState(h.store.searchText);function s(){let r=h.ghost.stateHistory.filter(o=>{let l=h.store.searchText.trim().toLowerCase();return l?o.guild?.name?.toLowerCase?.()?.includes(l)||o?.guild?.id==l||o?.channel?.name?.toLowerCase?.()?.includes(l)||o?.channel?.id==l||o?.user?.tag?.toLowerCase?.()?.includes(l)||o?.user?.id==l:!0}).slice(0,50).map(o=>(o.user=L.getUser(o.user.id),o)).filter(o=>o.user);console.log(r),t(r)}return i.useEffect(()=>{s();let r=setInterval(()=>{s()},1e3);return()=>{clearInterval(r)}},[]),i.createElement("div",{className:"vsl--container"},i.createElement("div",{className:"top"},i.createElement(J,{value:n,onChange:r=>{h.store.searchText=r,a(r)},placeholder:"Search...",className:"search-input"})),i.createElement("div",{className:`bottom ${oe.thin}`},e.map(r=>i.createElement("div",{className:"state"},i.createElement("div",{className:"left"},i.createElement("div",{className:"time"},new Date(r.at).toLocaleTimeString())),i.createElement("div",{className:"right"},i.createElement("div",{className:"top"},i.createElement("div",{className:"left"},i.createElement("div",{className:"avatar",style:{backgroundImage:`url("${r.user.avatar?`https://cdn.discordapp.com/avatars/${r.user.id}/${r.user.avatar}.${r.user.avatar.startsWith("a_")?"gif":"png"}`:`https://cdn.discordapp.com/embed/avatars/${Number(r.user.discriminator)%5}.png`}")`}}),i.createElement("div",{className:"tag"},i.createElement("span",null,r.user.tag.split("#")[0]),i.createElement("span",{className:"discriminator"},"#",r.user.tag.split("#")[1]))),r.states?i.createElement("div",{className:"right"},r.states.selfMute||r.states.mute||r.states.suppress?i.createElement(g,{text:`${r.states.mute?"Server ":""}Mute`},i.createElement(te,{color:y[r.states.mute?"DANGER":"SECONDARY"]})):null,r.states.selfDeaf||r.states.deaf?i.createElement(g,{text:`${r.states.deaf?"Server ":""}Deaf`},i.createElement(ee,{color:y[r.states.deaf?"DANGER":"SECONDARY"]})):null,r.states.selfVideo?i.createElement(g,{text:"Video"},i.createElement(ne,{color:y.SECONDARY})):null,r.states.selfStream?i.createElement(g,{text:"Stream"},i.createElement("div",{className:"vsl--icon vsl--red-dot"})):null):null),i.createElement("div",{className:"bottom"},i.createElement("div",{className:"left"},i.createElement("div",{className:"action"},r.action=="join"?i.createElement(g,{text:"Join"},i.createElement(re,{color:y.SUCCESS})):r.action=="leave"?i.createElement(g,{text:"Leave"},i.createElement(ae,{color:y.DANGER})):i.createElement(g,{text:"Stay"},i.createElement(ie,{color:y.SECONDARY}))),i.createElement("div",{className:"channel",onClick:()=>{q.transitionTo(`/channels/${r.guild.id}/${r.channel.id}`)}},r.channel.name)),i.createElement("div",{className:"right"},i.createElement("div",{className:"guild"},r.guild.name))))))))}class le{constructor(){this.patches=[]}add(...t){this.patches.push(...t)}remove(t){let[n]=this.patches.splice(this.patches.indexOf(a=>a==t),1);n()}removeAll(){let t=this.patches.splice(0,this.patches.length);for(let n=0;n<t.length;n++)t[n]()}}var j=new le,u={},x={},w={};w.isThenable=function(t){return t!=null&&typeof t.then=="function"},w.isArrayLike=function(t){return t!=null&&typeof t.length=="number"&&t.length>=0};const{isArrayLike:ce}=w;x.forEach=function(e,t,n){let a=0,s;if(ce(e))return s=e.length,{next(){if(a>=s)return[!0,null];const o=t.call(n,e[a],a,e);return a++,[!1,o]}};const r=Object.keys(e);return s=r.length,{next(){if(a>=s)return[!0,null];const o=r[a++],l=t.call(n,e[o],o,e);return[!1,l]}}},x.repeat=function(e,t,n){let a,s,r;return e&&typeof e=="object"?(a=e.start||0,s=e.step||1,r=e.done):(a=0,s=1,r=e),{next(){const o=t.call(n,a);return a+=s,a>=r?[!0,o]:[!1,o]}}},x.until=function(e,t){return{next(){const n=e.call(t);return[!1,n]}}},x.forOf=function(e,t,n){const a=e[Symbol.iterator]();return{next(){const s=a.next();if(s.done)return[!0,null];const r=t.call(n,s.value,e);return[!1,r]}}};var N={},O=(()=>{if(typeof setImmediate=="function")return e=>{setImmediate(e)};if(typeof process=="object"&&typeof process.nextTick=="function")return e=>{process.nextTick(e)};if(typeof MessageChannel=="function"){const e=new MessageChannel;let t={},n=t;return e.port1.onmessage=()=>{t=t.next;const a=t.task;delete t.task,a()},a=>{n=n.next={task:a},e.port2.postMessage(0)}}return e=>{setTimeout(e,0)}})();const{isThenable:ue}=w,$=N,I=O,A=1500;var fe=function(t,n=0){return new Promise((a,s)=>{let r=0;function o(){const l=Date.now();let f;try{for(;;){const[d,m]=t.next();if(ue(m)){m.then(H=>{d?a(H):H===$?a():o()},s);return}if(d){a(m);return}if(m===$){a();return}if(n>0||(f=Date.now()-l,r+=f,r>1e3))break;if(!(f<10))break}}catch(d){s(d);return}if(n>0){const d=Math.min(A,Date.now()-l+n);setTimeout(o,d)}else{const d=Math.min(A,f/3);r=0,d>10?setTimeout(o,d):I(o)}}I(o)})},de="chillout",me="Reduce CPU usage by non-blocking async loop and psychologically speed up in JavaScript",he="5.0.0",pe="polygon planet <polygon.planet.aqua@gmail.com>",ge={url:"https://github.com/polygonplanet/chillout/issues"},ve={"@babel/core":"^7.8.3","@babel/preset-env":"^7.8.3",babelify:"^10.0.0",bannerify:"^1.0.1",browserify:"^16.5.0","es6-shim":"^0.35.5",eslint:"^6.8.0",karma:"^4.4.1","karma-browserify":"^6.1.0","karma-chrome-launcher":"^3.1.0","karma-detect-browsers":"^2.3.3","karma-es6-shim":"^1.0.0","karma-firefox-launcher":"^1.3.0","karma-ie-launcher":"^1.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-safari-launcher":"^1.0.0",mocha:"^7.0.0","package-json-versionify":"^1.0.4",pidusage:"1.0.2","power-assert":"^1.6.1","uglify-js":"^3.7.5",uglifyify:"^5.0.2",watchify:"^3.11.1"},ye={node:">=8.10.0"},be=["dist/*","src/*"],Ee="https://github.com/polygonplanet/chillout",xe=["acceleration","async await","asynchronous","cpu use rate","cpu utilization rate","heavy processing","iterate","iteration","lightweight","nextTick","non-blocking","optimization","optimize for loop","performance","promise","reduce cpu usage","setimmediate","waitUntil"],we="MIT",Ce="src/index.js",ke={type:"git",url:"https://github.com/polygonplanet/chillout.git"},Se={benchmark:"node benchmark/benchmark",build:"npm run compile && npm run minify",compile:"browserify src/index.js -o dist/chillout.js -s chillout -p [ bannerify --file src/banner.js ] --no-bundle-external --bare",minify:"uglifyjs dist/chillout.js -o dist/chillout.min.js --comments -c -m -b ascii_only=true,beautify=false",test:"./node_modules/.bin/eslint . && npm run build && mocha test/**/*.spec.js --timeout 10000 && karma start karma.conf.js",travis:"npm run build && mocha test/**/*.spec.js --timeout 10000 && karma start karma.conf.js --single-run",watch:"watchify src/index.js -o dist/chillout.js -s chillout -p [ bannerify --file src/banner.js ] --no-bundle-external --bare --poll=200 -v"},Te={transform:["babelify","package-json-versionify"]},je={name:de,description:me,version:he,author:pe,bugs:ge,devDependencies:ve,engines:ye,files:be,homepage:Ee,keywords:xe,license:we,main:Ce,repository:ke,scripts:Se,browserify:Te};const b=x,E=fe,{isThenable:Le,isArrayLike:_e}=w,De=O,Ne=N;u.version=je.version,u.forEach=function(t,n,a){return E(b.forEach(t,n,a))},u.repeat=function(t,n,a){return E(b.repeat(t,n,a))},u.until=function(t,n){return E(b.until(t,n))};const Oe=13;u.waitUntil=function(t,n){return E(b.until(t,n),Oe)},u.forOf=function(t,n,a){return E(b.forOf(t,n,a))},u.StopIteration=Ne,u.iterate=E,u.iterator=b,u.isThenable=Le,u.isArrayLike=_e,u.nextTick=De;async function $e(){let e=[];return await u.forEach(Object.values(k.getAllVoiceStates()||{}),async t=>{await u.forEach(Object.values(t||{}),n=>{let a=P(n);a&&e.push([n.userId,a])})}),Object.fromEntries(e)}async function M(){let e=new Set;return await u.forEach(Object.values(k.getAllVoiceStates()||{}),async t=>{await u.forEach(Object.values(t||{}),n=>{e.add(n.userId)})}),[...e]}function Ie(e){let t=k.getVoiceStateForUser(e);return t?P(t):null}function V(e){if(!e)return"null";let t=[`user:${e.user.id}`,`guild:${e.guild?.id||null}`,`channel:${e.channel?.id||null}`];for(const n in e.states)t.push(`${n}:${e.states[n]}`);return t.join(";")}function P(e){let t=Y.getChannel(e.channelId),n=Z.getGuild(t?.guild_id);return{states:{deaf:e.deaf,mute:e.mute,selfDeaf:e.selfDeaf,selfMute:e.selfMute,selfStream:e.selfStream,selfVideo:e.selfVideo,suppress:e.suppress},isPrivate:!n,user:{id:e.userId,tag:L.getUser(e.userId).tag},channel:t?{id:t.id,name:t.name}:void 0,guild:n?{id:n.id,name:n.name}:void 0}}function Ae(){j.add((()=>{let e=[],t={},n=!1;return(async()=>{e=await M(),t=await $e();async function a(){n||(await u.forEach(e,s=>{if(n)return u.StopIteration;try{let r=Ie(s);if(r?.isPrivate)return;let o=t[s];if(V(o)==V(r))return;!o?.channel&&r?.channel?h.store.stateHistory.unshift({...r,at:Date.now(),action:"join"}):o?.states&&r?.states&&o.channel.id!=r.channel.id?h.store.stateHistory.unshift({...r,at:Date.now(),action:"join"},{...o,at:Date.now(),action:"leave"}):o?.states&&!r?.states?h.store.stateHistory.unshift({...o,at:Date.now(),action:"leave"}):h.store.stateHistory.unshift({...r,at:Date.now(),action:"stay"}),r?t[s]=r:delete t[s],h.ghost.stateHistory.length>2048&&(h.store.stateHistory.length=2048)}catch{}}),e=await M(),await new Promise(s=>setTimeout(s,1e3)),a())}a()})(),()=>{n=!0,e=[],t={}}})())}var Me=()=>B.injectCSS(".vsl--container{display:flex;flex-direction:column;z-index:1}.vsl--container>.top{width:100%;margin-bottom:16px}.vsl--container>.bottom{width:100%;height:100%;overflow:auto;padding-bottom:16px}.vsl--container>.bottom>.state{display:flex;align-items:center;background-color:#202225;margin-bottom:8px;border-radius:8px;color:#f5f5f5}.vsl--container>.bottom>.state>.left{font-size:14px;width:max-content;width:70px;padding:8px}.vsl--container>.bottom>.state>.right{width:100%;background-color:#2e3135;border-radius:8px;padding:8px;display:flex;flex-direction:column}.vsl--container>.bottom>.state>.right>.top{display:flex;align-items:center;justify-content:space-between;margin-bottom:4px}.vsl--container>.bottom>.state>.right>.top>.left{display:flex;align-items:center}.vsl--container>.bottom>.state>.right>.top>.left>.avatar{background-position:center;background-size:contain;width:24px;height:24px;border-radius:4px;margin-right:8px}.vsl--container>.bottom>.state>.right>.top>.left>.tag{display:flex;font-size:20px;font-weight:500}.vsl--container>.bottom>.state>.right>.top>.left>.tag>.discriminator{opacity:.5}.vsl--container>.bottom>.state>.right>.top>.right{display:flex;align-items:center}.vsl--container>.bottom>.state>.right>.top>.right .vsl--icon:not(.vsl--red-dot){margin-left:4px;width:20px;height:20px}.vsl--container>.bottom>.state>.right>.top>.right .vsl--red-dot{margin-left:4px;width:14px;height:14px}.vsl--container>.bottom>.state>.right>.bottom{display:flex;align-items:center;justify-content:space-between}.vsl--container>.bottom>.state>.right>.bottom>.left{display:flex;align-items:center;margin-left:32px}.vsl--container>.bottom>.state>.right>.bottom>.left>.action{margin-right:4px}.vsl--container>.bottom>.state>.right>.bottom>.left>.action .vsl--icon{width:20px;height:20px}.vsl--container>.bottom>.state>.right>.bottom>.left>.channel{opacity:.85;cursor:pointer}.vsl--container>.bottom>.state>.right>.bottom>.right{display:flex;align-items:flex-end;font-size:12px;opacity:.75}.vsl--icon{display:flex;width:16px;height:16px;transition:filter .1s ease-in-out}.vsl--red-dot{width:10px;height:10px;border-radius:50%;background-color:#ed4245;box-shadow:0 0 4px #ed4245}");function Ve(){const e=Me();j.add(e)}var Pe={onLoad(){Ve(),Ae()},onUnload(){j.removeAll()},settings(){return c.createElement(se,null)}};return Pe})(cumcord.modules.common.React,cumcord.modules.webpack,cumcord.utils,cumcord.patcher);
